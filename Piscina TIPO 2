import streamlit as st
import math

# Configurazione pagina
st.set_page_config(page_title="Dimensionamento Piscina UNI 10637", layout="centered")

st.title("ðŸŠ Dimensionamento Impianto Piscina")
st.subheader("Conforme UNI 10637:2024 - Tipo 2")

# --- Sidebar per Input Dati ---
st.sidebar.header("Dati Geometrici Vasca")
L = st.sidebar.number_input("Lunghezza totale (m)", min_value=1.0, value=12.0)
W = st.sidebar.number_input("Larghezza (m)", min_value=1.0, value=6.0)
h_min = st.sidebar.number_input("ProfonditÃ  minima (m)", min_value=0.0, value=1.0)
h_max = st.sidebar.number_input("ProfonditÃ  massima (m)", min_value=0.0, value=1.5)

# --- Logica di Calcolo ---
pendenza = (h_max - h_min) / L

def get_tempo_ricircolo(h):
    # Dati dal Prospetto 3 fornito
    if h > 1.35: return 3.0    # Zona C
    if h > 0.6:  return 2.5    # Zona D
    if h > 0.4:  return 1.0    # Zona E
    return 0.5                 # Zona F

passo = 0.1
portata_totale = 0
volume_totale = 0
x = 0

while x < L:
    h_corrente = h_min + (x * pendenza)
    t_zona = get_tempo_ricircolo(h_corrente)
    v_segmento = (passo * W) * h_corrente
    portata_totale += v_segmento / t_zona
    volume_totale += v_segmento
    x += passo

# --- Visualizzazione Risultati ---
col1, col2 = st.columns(2)

with col1:
    st.metric("Volume Totale", f"{volume_totale:.2f} mÂ³")
    st.metric("Portata Progetto (Q)", f"{portata_totale:.2f} mÂ³/h")

with col2:
    v_filtrazione = 30 # m/h
    area_filtro = portata_totale / v_filtrazione
    st.metric("Area Filtrante Min.", f"{area_filtro:.2f} mÂ²")
    
    # Calcolo diametri
    v_mandata = 1.5
    area_t = (portata_totale / 3600) / v_mandata
    diam_mm = math.sqrt(area_t / math.pi) * 2 * 1000
    st.metric("Diametro Mandata", f"{diam_mm:.0f} mm")

st.info(f"Nota: Il calcolo utilizza i tempi di ricircolo differenziati per zone (C, D, E, F) secondo il Prospetto 3 della norma.")
